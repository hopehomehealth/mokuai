<?php/** * ZZCMS 多媒体分类 */class gallery_tag extends Lowxp{    function __construct(){        #按钮        $this->btnMenu = array(            0=>array('url'=>'#!gallery_tag/index','name'=>'多媒体分类'),            1=>array('url'=>'#!gallery_tag/edit?com=xshow|添加多媒体分类','name'=>'添加分类'),        );        parent::__construct();        $this->load->model('gallery_tag');    }    function index($page=1){        #分页        $this->load->model('page');        $_GET['page'] = intval($page);        $this->page->set_vars(array('per'=>(int)$this->common['page_listrows']));        #数据集        $sql = "SELECT * FROM ###_gallery_tag WHERE `type`='image' ORDER BY id";        $data['list'] = $this->page->hashQuery($sql)->result_array();        $this->smarty->assign('data',$data);        $this->smarty->display('manage/gallery_tag/list.html');    }    //创建/更新    function edit(){        //提交        if(isset($_POST['Submit'])){            $res = $this->gallery_tag->save();            if(isset($res['code']) && $res['code']==0){                $this->tip($res['message'],array('inIframe'=>true));                $this->exeJs("parent.com.xhide();parent.main.refresh()");            }else{                $this->tip($res['message'],array('inIframe'=>true,'type'=>1));            }            exit;        }        $id = (int) $_GET['id'];        $row = array();        //编辑        if($id){            $row = $this->db->get("SELECT * FROM ###_gallery_tag WHERE id=".$id);            $this->smarty->assign('id',$id);        }        if(!$id) $this->smarty->assign('btnNo',1);        $this->smarty->assign('row',$row);        $this->smarty->display('manage/gallery_tag/edit.html');    }    //删除    function del(){        $id = (int) $_POST['id'];        if(!$id) die;        admin_log('删除多媒体分类：'.$this->db->getstr("SELECT name FROM ###_gallery_tag WHERE id=".$id));        $this->db->delete('###_gallery_tag', array('id'=>$id));        $this->tip('删除成功');    }}