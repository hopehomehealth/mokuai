<?php/** * ZZCMS goodscat_model * ============================================================================ * * 版权所有 2014-2016 厦门紫竹数码科技有限公司，并保留所有权利。 * 网站地址: http://www.lnest.com； * ---------------------------------------------------------------------------- * 这不是一个自由软件！您只能在不用于商业目的的前提下对程序代码进行修改和 * 使用；不允许对程序代码以任何形式任何目的的再发布。 */class crowd_model extends Lowxp_Model{    public $crowd_power = 0; #商家功能总开关    function __construct(){}    function get_info($id){        if(empty($id)) return false;        $row = $this->db->get("SELECT c.*,d.* FROM ###_crowd AS c,###_crowd_detail AS d WHERE c.cd_id = $id AND c.cd_id = d.cd_id");        return $row;    }    /**     * 保存数据     * @return array     */    function save($post=array()){    }    function del($id=""){        $row = $this->db->get("SELECT * FROM ###_crowd WHERE cd_id=".$id);        if(isset($row['cd_id'])){            admin_log('删除众筹：'.$row['crowd_name']);            $result = $this->db->delete('###_crowd',array('cd_id'=>$id));        }        return $result;    }    function get_crowd($where=""){        return $this->db->select("SELECT * FROM ###_crowd WHERE $where");    }    function get_return_info($id="",$where=""){        $where = !empty($id) ? "rt_id = $id" : $where;        $row = $this->db->get("SELECT * FROM ###_crowd_return WHERE $where");        return $row;    }    function get_return($where=""){        return $this->db->select("SELECT * FROM ###_crowd_return WHERE $where ORDER BY listorder DESC,rt_id ASC");    }    function del_return($id=""){        $row = $this->db->get("SELECT * FROM ###_crowd_return WHERE rt_id=".$id);        if(isset($row['rt_id'])){            admin_log('删除回报：'.$row['rt_name']);            $result = $this->db->delete('###_crowd_return',array('rt_id'=>$id));        }        return $result;    }    function del_member($id=""){        $result = $this->db->delete('###_crowd_member',array('id'=>$id));        return $result;    }    /**     * 获取进展列表     * @param string $where     * @param int $page_size     * @param int $page     * @param string $feild     * @param string $url     */    function progress_list($where="",$page_size=10, $page=1, $feild="*",$url='href="/crowd/{num}"'){        #分页        $this->load->model('page');        $_GET['page'] = intval($page);        $page_size = empty($page_size) ? (int)$this->site_config['page_size'] : $page_size;        $this->page->set_vars(array('per'=>$page_size,'url'=>$url));        $list = $this->page->hashQuery("SELECT $feild FROM ###_crowd_progress WHERE $where")->result_array();        if(!empty($list)){            foreach($list as $key=>$val){                $list[$key]['thumb'] = unserialize($val['thumbs']);            }        }        return $list;    }    /**     * 列表     * @param string $where     * @param int $page_size     * @param int $page     * @param string $feild     * @param string $url     * @return array     */    function crowd_list($where="",$page_size=10, $page=1, $feild="*",$url='href="/crowd/{num}"'){        #分页        $this->load->model('page');        $_GET['page'] = intval($page);        $page_size = empty($page_size) ? (int)$this->site_config['page_size'] : $page_size;        $this->page->set_vars(array('per'=>$page_size,'url'=>$url));        $list = $this->page->hashQuery("SELECT $feild FROM ###_crowd WHERE $where")->result_array();        return $list;    }    /**     * 获取众筹状态1报名中2进行中3已结算     * @param $data     */    function crowd_status($data){        if($data['apply_endtime']>RUN_TIME) $status = 1;        if($data['apply_endtime']<=RUN_TIME && $data['end_time']>RUN_TIME) $status = 2;        if($data['end_time']<RUN_TIME) $status = 3;        return $status;    }}