<?php/** * Class database_model */class databases_model extends Lowxp_Model{    //更新数据库    function updateDb(){        $ok = 1;        return $ok;    }    //sql执行    function query_sql($sql){        $data = array('type'=>0, 'html'=>'');        /* 解析查询项 */        $sql = str_replace("\r", '', $sql);        $query_items = explode(";\n", $sql);        foreach ($query_items as $key=>$value)        {            if (empty($value))            {                unset($query_items[$key]);            }        }        /* 如果是多条语句，拆开来执行 */        if (count($query_items) > 1)        {            foreach ($query_items as $key=>$value)            {                if ($this->db->query($value,0))                {                    $data['type'] = 1;                    $data['html'] = '<b class="c-green">SQL批量执行完成！</b>';                }                else                {                    $data['type'] = 0;                    $data['html'] = '<b class="c-red">'.$this->db->error().'</b>';                }            }            return $data;        }        /* 单独一条sql语句处理 */        if (preg_match("/^(?:UPDATE|DELETE|TRUNCATE|ALTER|DROP|FLUSH|INSERT|REPLACE|SET|CREATE)\\s+/i", $sql))        {            if ($this->db->query($sql,0))            {                $data['type'] = 1;                $data['html'] = '<b class="c-green">SQL执行完成！</b>';            }            else            {                $data['type'] = 0;                $data['html'] = '<b class="c-red">'.$this->db->error().'</b>';            }            return $data;        }        elseif (preg_match("/^(?:SELECT)\\s+/i", $sql))        {            $list = $this->db->query($sql,0);            if ($list === false){                $data['type'] = 0;                $data['html'] = '<b class="c-red">'.$this->db->error().'</b>';                return $data;            }            $list = $list->result_array();            $result = '';            if ($list && is_array($list))            {                $result = "<table class='list'><thead><tr>";                $keys = array_keys($list[0]);                for ($i = 0, $num = count($keys); $i < $num; $i++)                {                    $result .= "<th style='text-align:left'>" . $keys[$i] . "</th>";                }                $result .= "</tr></thead><tbody>";                foreach ($list AS $data1)                {                    $result .= "<tr>";                    foreach ($data1 AS $value)                    {                        $result .= "<td style='text-align:left'>" . $value . "</td>";                    }                    $result .= "</tr>";                }                $result .= "</tbody></table>";            } else {                $result ="<center><h3>没有记录！</h3></center>";            }            $data['type'] = 2;            $data['html'] = $result;        }else{            $data['type'] = 0;            $data['html'] = '<b class="c-red">SQL语句错误！</b>';        }        return $data;    }}