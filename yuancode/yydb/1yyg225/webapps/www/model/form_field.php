<?php/* * form_field_model * 生成模型表单 */class form_field_model extends Lowxp_Model{    public $data = array(),$lang,$id;    function __construct($data=array()){        $this->data = $data;        $this->lang = LANG_ID;    }    function setData($data=array()){        $this->__construct($data);    }    public function catid($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : $this->data[$field];        $moduleid =$info['moduleid'];        $this->load->model('category');        $select_category = $this->category->category_option($value,$moduleid);        $parseStr = '<select name="post['.$field.']" id='.$id.'>';        $parseStr .= '<option value="">请选择</option>';        $parseStr .= $select_category;        $parseStr .= '</select>';        return $parseStr;    }    public function title($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : $this->data[$field];        $style = $info['setup']['size'] ? 'width:'.$info['setup']['size'].'px;' : '';        $parseStr = '<input type="text" class="form-i w360" name="post['.$field.']" id='.$id.' value="'.$value.'" style="'.$style.'" />';        if($info['setup']['thumb']){            $info_thumb['field']='thumb';            $btntext = trim($info['setup']['btntext'])?$info['setup']['btntext']:'上传缩略图';            $parseStr .= $this->upfiles($info_thumb,'','',$btntext);        }        return $parseStr;    }    public function text($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $style = $info['setup']['size'] ? 'width:'.$info['setup']['size'].'px;' : '';        $inputtext = $info['setup']['ispassword'] ? 'password' : 'text';        $parseStr = '<input type="'.$inputtext.'" class="form-i w300" name="post['.$field.']" id="'.$id.'" value="'.$value.'" style="'.$style.'" />';        return $parseStr;    }    public function textarea($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $style = $info['setup']['width'] ? 'width:'.$info['setup']['width'].'px;' : '';        $style .= $info['setup']['height'] ? 'height:'.$info['setup']['height'].'px;' : '';        $parseStr = '<textarea name="post['.$field.']" id='.$id.' style="'.$style.'">'.stripcslashes($value).'</textarea>';        return $parseStr;    }    public function editor($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $style = 'width:670px;' . ($info['setup']['height'] ? 'height:'.$info['setup']['height'].'px;' : 'height:220px;');        $parseStr = $this->form->editor($field, $value,' name="post['.$field.']" style="'.$style.'"',$info['setup']);        return $parseStr;    }    public function number($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $style = $info['setup']['size'] ? 'width:'.$info['setup']['size'].'px;' : '';        $inputtext = $info['setup']['ispassword'] ? 'password' : 'text';        $parseStr = '<input type="'.$inputtext.'" class="form-i w300" name="post['.$field.']" id='.$id.' value="'.$value.'" style="'.$style.'" />';        return $parseStr;    }    public function select($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $optionsarr = array();        if($info['setup']['options']){            $optionsarr = $this->base->explodeChar($info['setup']['options']);        }        if(!empty($info['setup']['multiple'])) {            $parseStr = $this->form->select($optionsarr,$value,'name="post['.$field.'][]" id="'.$field.'"'.' size="'.$info['setup']['size'].'" multiple="multiple" style="height:auto"');        }else{            $default_option = '请选择';            $parseStr = $this->form->select($optionsarr,$value,'name="post['.$field.']" id="'.$field.'"',$default_option);        }        return $parseStr;    }    public function radio($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $optionsarr = array();        if($info['setup']['options']){            $optionsarr = $this->base->explodeChar($info['setup']['options']);        }        $parseStr = $this->form->radio($optionsarr,$value,'name="post['.$field.']"',$info['setup']['labelwidth'],$id);        return $parseStr;    }    public function checkbox($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $optionsarr = array();        if($info['setup']['options']){            $optionsarr = $this->base->explodeChar($info['setup']['options']);        }        $parseStr = $this->form->checkbox($optionsarr,$value,'name="post['.$field.'][]"','',$info['setup']['labelwidth'],$id);        return $parseStr;    }    public function datetime($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : date('Y-m-d H:i:s',($this->data['id'] ? $this->data[$field] : time()));        $parseStr = '<input type="text" class="form-i Wdate" name="post['.$field.']" id='.$id.' value="'.$value.'" onclick="WdatePicker({dateFmt:\'yyyy-MM-dd HH:mm:ss\'})" style="padding-right:15px;" />';        return $parseStr;    }    public function posid($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : $this->data[$field];        $options = array();        $res_posid = $this->db->select('select * from ###_posid order by listorder,id');        foreach($res_posid as $key=>$r) {            $options[$r['id']]=$r['name'];        }        $parseStr .= $this->form->checkbox($options,$value,'name="post['.$field.'][]"','','',$id);        return $parseStr;    }    public function linkage($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : ($this->data['id'] ? $this->data[$field] : $info['setup']['default']);        $this->load->model('linkage');        $id = $this->db->getstr("select id from ###_linkage where lang=".LANG_ID." and `mark`='".$info['setup']['mark']."'");        $parseStr = '<div id="select_linkage">';        $parseStr .= $this->linkage->select_linkage($value?$value:$id,1,$field);        $parseStr .= '</div>';        return $parseStr;    }    public function template($info,$value){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : $this->data[$field];        $options = array();        $module = $this->data['module'];        //$module = $this->db->getstr("select module from ###_category where id=".$this->data['catid']);        $this->load->library('dir');        $path = AppDir.'views/'.LANG_NAME.'/';        $ext='html';        $tempfiles = $this->dir->dir_list($path,$ext);        foreach ($tempfiles as $key=>$file){            $dirname = basename($file);            $file_name =  substr($dirname,0,strrpos($dirname, '.'));            $file_value = substr($file_name,strpos($file_name, '_')+1);            if($module && strstr($dirname,$module.'_') && strstr($file_value,'show')){                $options[$file_value] = $dirname;            }        }        $parseStr = $this->form->select($options,$value,'name="post['.$field.']" id="'.$field.'"','请选择');        return $parseStr;    }    public function verify($info,$value){        $id = $field = $info['field'];        $style = $info['setup']['size'] ? 'width:'.$info['setup']['size'].'px;' : '';        $parseStr   = '<input type="text" class="form-i w60 verify" name="post['.$field.']"  id="'.$id.'" value="" style="'.$style.'" /><img src="/welcome/scode" class="imgcode" onclick="this.src=\'/welcome/scode?xrand=\'+Math.random();" width="65" height="23" style="vertical-align:middle;" />';        return $parseStr;    }    public function files($info,$value){        $type = 'file';        $parseStr = $this->upfiles($info,$value,$type);        return $parseStr;    }    public function images($info,$value){        $type = 'image';        $parseStr = $this->upfiles($info,$value,$type);        return $parseStr;    }    private function upfiles($info,$value,$type='',$str=''){        $field = $id = $info['field'];        $value = (isset($value) && $value!=='') ? $value : $this->data[$field];        $value = json_decode($value,true);        $str   = $str?$str:(($type=='file')?'上传文件':'上传图片');        $type  = $type?$type:'image';        $os = array(            'type'=>$type,            'maxnum'=>intval($info['setup']['upload_maxnum']) < 1 ? 1 : intval($info['setup']['upload_maxnum']),            'file_types'=>$info['setup']['upload_allowext'],            'file_size_limit'=>$info['setup']['upload_maxsize'].' MB',        );        $o = array(        );        $parseStr = $this->form->files($field, $value, $str, $os, $o);        return $parseStr;    }}?>