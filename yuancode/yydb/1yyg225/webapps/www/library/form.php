<?phpclass Form_Library {	/**	 * 下拉选择框	 */	public static function select($array = array(), $id = 0, $str = '', $default_option = '', $default_value='') {		$string = '<select '.$str.'>';		$default_selected = (empty($id) && $id!==0 && $default_option) ? 'selected' : '';		if($default_option) $string .= "<option value='".$default_value."' $default_selected>$default_option</option>";		if((!is_array($array) || count($array)== 0) && $default_option == '') return false;		$ids = array();		if(isset($id)) $ids = explode(',', $id);		foreach($array as $key=>$value) {			$selected = (in_array($key, $ids) && $id!=='') ? ' selected' : '';            $v = $value; $disabled = '';            if(is_array($value)){                $v = $value[0];                if($value[1]=='disabled') $disabled = ' disabled';            }			$string .= '<option value="'.$key.'" '.$disabled.$selected.'>'.$v.'</option>';		}		$string .= '</select>';		return $string;	}		/**	 * 复选框	 */	public static function checkbox($array = array(), $id = '', $str = '', $defaultvalue = '', $width = 0, $field = '') {		$string = '';        $style = $width ? 'style="float:left;width:'.$width.'px;"' : '';		$id = trim($id);		if($id != '') $id = strpos($id, ',') ? explode(',', $id) : array($id);		if($defaultvalue) $string .= '<input type="hidden" '.$str.' value="-99">';		$i = 1;		foreach($array as $key=>$value) {			$key = trim($key);			$checked = ($id && in_array($key, $id)) ? 'checked' : '';            $string .= '<label '.$style.'>';			$string .= '<input type="checkbox" '.$str.' id="'.$field.'_'.$i.'" '.$checked.' value="'.$key.'"> '.$value;			$string .= '</label> &nbsp;';			$i++;		}		return $string;	}	/**	 * 单选框	 */	public static function radio($array = array(), $id = 0, $str = '', $width = 0, $field = '') {		$string = '';        $style = $width ? 'style="float:left;width:'.$width.'px;"' : '';		foreach($array as $key=>$value) {			$checked = trim($id)==trim($key) ? 'checked' : '';			$string .= '<label '.$style.'>';			$string .= '<input type="radio" '.$str.' id="'.$field.'_'.$key.'" '.$checked.' value="'.$key.'"> '.$value;			$string .= '</label> &nbsp;';		}		return $string;	}    /**     * 编辑器     */    public static function editor($field, $value='', $str='', $info=array('toolbar'=>'full')){        global $lowxp;        $edit_options = "[            'source', '|', 'undo', 'redo', '|', 'preview', 'print', 'template', 'code', 'cut', 'copy', 'paste',            'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',            'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',            'superscript', 'clearhtml', 'quickformat', 'selectall', '|', 'fullscreen', '/',            'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',            'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'multiimage',            'flash', 'media', 'table', 'hr', 'emoticons', 'baidumap', 'pagebreak',            'anchor', 'link', 'unlink'        ]";        if($info['toolbar'] == 'basic'){            $edit_options = "[                'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',                'insertunorderedlist', '|', 'emoticons', 'image', 'link','|','source','fullscreen'            ]";        }        $c = ($lowxp->mod == 'manage') ? $lowxp->common : $lowxp->site_config;        $edit_folder = 'edit';        if(isset($c['cloudsave']) && $c['cloudsave']){            $edit_folder = '_edit';        }        if($lowxp->mod=='manage'){            $str = '<textarea id="editor_'.$field.'" '.$str.'>'.stripcslashes($value).'</textarea><pre class="editorPre">'.stripcslashes($value).'</pre>';            $str .= '<script type="text/javascript">$.loadJs("/admin/js/'.$edit_folder.'/kindeditor.js",function(){ $.loadJs("/admin/js/'.$edit_folder.'/lang/zh_CN.js",function(){ com.initEdit("#editor_'.$field.'",'.$edit_options.'); })})</script>';        }else{            $str = '<textarea name="'.$field.'" '.$str.'>'.stripcslashes($value).'</textarea><pre class="editorPre">'.stripcslashes($value).'</pre>';            $str .= '<script type="text/javascript" src="/admin/js/'.$edit_folder.'/kindeditor.js"></script><script type="text/javascript" src="/admin/js/'.$edit_folder.'/lang/zh_CN.js"></script>            <script type="text/javascript">            KindEditor.ready(function(K){                var editor1 = K.create(\'textarea[name="'.$field.'"]\', {});            });            </script>';        }        return $str;    }    /** 上传控件     * @param $field 唯一字段名     * @param $value json默认值     * @param $str   按钮文本     * @param $os    上传配置     * @param $o     其它配置     * @return string     */    public static function files($field, $value, $str='上传图片', $os=array(), $o=array()){        $os = array_merge(array(            'type'=>'image',        ), $os);        $o = array_merge(array(            'id'=>'upFiles_'.$field,            'namePath'=>'post['.$field.'][path][]',            'nameTitle'=>'post['.$field.'][title][]',        ), $o);        $class = ($os['type']=='file')?'BtnBlue':'BtnOrange';        if(!is_array($value)){ $value = json_decode($value,true); }        $html = '<input type="hidden" name="post['.$field.']" value="" />';        if(!empty($value)){            foreach($value as $k=>$v){                $html .= '<div><input type="text" class="form-i inputPath" name="'.$o['namePath'].'" value="'.$v['path'].'">' .                         '<input type="text" class="form-i inputTitle" name="'.$o['nameTitle'].'" value="'.$v['title'].'"> '.                    '<a href="'.$v['path'].'" target="_blank" class="iconfont c-green seePic" title="查看缩略图" onmousemove="main.seepic(this)">&#xe602;<span><img src="'.$v['path'].'" /></span></a> ' .                         '<a href="javascript:;" class="a-del" title="移除" onclick="[this.parentNode].remove()">×</a> ' .                         '</div>';            }        }        $tips = ' <span class="form-tip">';        $tips .= ($os['maxnum']>1)?'数量限制（'.$os['maxnum'].'）':'';        $tips .= intval($os['file_size_limit'])?'大小限制（'.$os['file_size_limit'].'以内）':'';        $tips .= $os['file_types']?'文件格式（'.$os['file_types'].'）':'';        $tips .= '</span>';        $tips = '';        $str = '<div id="upFiles_'.$field.'" class="filesBox">'.$html.'</div><a href="javascript:;" class="uiBtn '.$class.'" onclick=\'upfiles.files('.json_encode($os).','.json_encode($o).')\'>'.$str.'</a>'.$tips;        $str .= "<script type='text/javascript'>$.loadJs('/admin/js/upload.js',function(){ $.loadJs('/admin/js/manage/upfiles.js',function(){ }) })</script>";        return $str;    }    /**     * SWFUPLOAD上传控件(前台使用)     * $input表单名     * 缩放宽$width高$height     * $limit限制上传个数     */    public static function upload_files($input,$width='',$height='',$limit=1,$file_types='',$file_size='',$option=array()){        $file_types = $file_types ? $file_types : 'gif,jpg,jpeg,png';        $file_size = $file_size ? $file_size : '20'; //MB        //配置参数设置默认值        $option['btn_title'] || $option['btn_title'] = '选择文件';        isset($option['resize']) || $option['resize'] = 'false';        $display = $limit>1 || ($limit==1 && empty($value)) ? 'display:none;' : '';        $html = "";        if($limit==1){            $input_html = "<input type='hidden' name='{$input}' value=''/>";        }else{            $input_html = "<div id='upload_success'></div>";        }        $mimetype = '.'.str_replace(',',',.',$file_types);        $html .= "<link rel=\"stylesheet\" type=\"text/css\" href=\"/style/webuploader/webuploader.css\">                        <script type=\"text/javascript\" src=\"/style/webuploader/webuploader.js\"></script>";        $fileNumLimit = $limit==1 ? '' : "fileNumLimit:{$limit},";        $html .= "<div id=\"uploader_$input\" class=\"wu-example\">                            <div class=\"btns\">                                <div id=\"picker{$input}\">$option[btn_title]</div>                            </div>                            {$input_html}                            <img src=\"/style/swf_up/img.jpg\" class=\"showimg\" id=\"{$input}\" style=\"vertical-align: top; margin-top:3px; margin-left:10px; {$display}\"/>                            <!--用来存放文件信息-->                            <div id=\"thelist{$input}\" class=\"uploader-list\"></div>                        </div>                        <script type=\"text/javascript\">                            $(function(){                                var $ = jQuery,                                        \$list = $('#thelist{$input}'),                                        \$btn = $('#ctlBtn{$input}'),                                        state = 'pending',                                        uploader;                                var uploader = WebUploader.create({                                    swf:  '/style/webuploader/Uploader.swf',                                    server: '".url('/home/fileupload')."',                                    pick: '#picker{$input}',                                    resize: $option[resize],                                    $fileNumLimit                                    formData:{'dir' : '".$input."', 'width' : '".$width."', 'height' : '".$height."' },                                    chunked:false,                                    fileSizeLimit:$file_size*1024*1024,                                    auto:true,                                    sendAsBinary:true,                                    accept:{extensions:'{$file_types}',mimeTypes: '{$mimetype}'}                                })                                // 当有文件添加进来的时候                                uploader.on( 'fileQueued', function( file ) {                                    \$list.append( '<div id=\"' + file.id + '\">' +                                            '<b class=\"info\">' + file.name + '</b>' +                                            '<span class=\"state\">等待上传...</span>' +                                            '</div>' );                                });                                // 文件上传过程中创建进度条实时显示。                                uploader.on( 'uploadProgress', function( file, percentage ) {                                    var \$li = $( '#'+file.id ),                                            \$percent = \$li.find('.progress .progress-bar');                                    // 避免重复创建                                    if ( !\$percent.length ) {                                        \$percent = $('<div class=\"progress progress-striped active\">' +                                                '<div class=\"progress-bar\" role=\"progressbar\" style=\"width: 0%\">' +                                                '</div>' +                                                '</div>').appendTo( \$li ).find('.progress-bar');                                    }                                    \$li.find('.state').text('上传中');                                    \$percent.css( 'width', percentage * 100 + '%' );                                });                                uploader.on( 'uploadSuccess', function( file ,response) {                                    $( '#'+file.id ).find('.state').text('已上传');                                    console.log(response);                                    ";        if($limit==1){            $html .= "                           $('input[name={$input}]').val(response.data);                           $('#{$input}').attr('src',response.data).load(function() {                                if(photo){ loadPhoto(); }                           });                    ";        }else{            $html .= "$('#upload_success').append(\"<input name='{$input}[]' type='hidden' value='\"+response.data+\"'/>\");                           $('#{$input}').attr('src',response.data);";        }        $html .= "                                });                                uploader.on( 'uploadError', function( file ) {                                    $( '#'+file.id ).find('.state').text('上传出错');                                });                                uploader.on( 'uploadComplete', function( file ){                                    $( '#'+file.id ).find('.progress').fadeOut();                                });                                uploader.on( 'all', function( type ) {                                    if ( type === 'startUpload' ) {                                        state = 'uploading';                                    } else if ( type === 'stopUpload' ) {                                        state = 'paused';                                    } else if ( type === 'uploadFinished' ) {                                        state = 'done';                                    }                                    if ( state === 'uploading' ) {                                        \$btn.text('暂停上传');                                    } else {                                        \$btn.text('开始上传');                                    }                                });                                \$btn.on( 'click', function() {                                    if ( state === 'uploading' ) {                                        uploader.stop();                                    } else {                                        uploader.upload();                                    }                                });                            });                        </script>";        return $html;    }    /**     * SWFUPLOAD上传控件(APP使用)     * $input表单名     * 缩放宽$width高$height     * $limit限制上传个数     */    public static function app_upload_files($input,$width='',$height='',$limit=1,$file_types='gif,jpg,jpeg,png',$file_size='10 MB'){        $display = $limit>1 || ($limit==1 && empty($value)) ? 'display:none;' : '';        $html = "";        if($limit==1){            $input_html = "<input type='hidden' name='{$input}' value=''/>";        }else{            $input_html = "<div id='upload_success'></div>";        }        $mimetype =  'image/*';        $html .= "<link rel=\"stylesheet\" type=\"text/css\" href=\"../script/webuploader/webuploader.css\">";        $html .= "<div id=\"uploader\" class=\"wu-example\">                            <!--用来存放文件信息-->                            <div id=\"thelist{$input}\" class=\"uploader-list\"></div>                            <div class=\"btns\">                                <div id=\"picker{$input}\">选择文件</div>                            </div>                            {$input_html}                            <img src=\"/style/swf_up/img.jpg\" class=\"showimg\" id=\"{$input}\" style=\"vertical-align: top; margin-top:3px; margin-left:10px; {$display}\"/>                        </div>                        <script type=\"text/javascript\">                            $(function(){                                var $ = jQuery,                                        \$list = $('#thelist{$input}'),                                        \$btn = $('#ctlBtn{$input}'),                                        state = 'pending',                                        uploader;                                var uploader = WebUploader.create({                                    swf:  '../script/webuploader/Uploader.swf',                                    server: '".url('/home/fileupload')."',                                    pick: '#picker{$input}',                                    resize: false,                                    fileNumLimit:{$limit},                                    formData:{'dir' : '".$input."', 'width' : '".$width."', 'height' : '".$height."' },                                    chunked:true,                                    fileSizeLimit:20*1024*1024,                                    auto:true,                                    sendAsBinary:true,                                    accept:{extensions:'{$file_types}',mimeTypes: '{$mimetype}'}                                })                                // 当有文件添加进来的时候                                uploader.on( 'fileQueued', function( file ) {                                    \$list.append( '<div id=\"' + file.id + '\">' +                                            '<b class=\"info\">' + file.name + '</b>' +                                            '<span class=\"state\">等待上传...</span>' +                                            '</div>' );                                });                                // 文件上传过程中创建进度条实时显示。                                uploader.on( 'uploadProgress', function( file, percentage ) {                                    var \$li = $( '#'+file.id ),                                            \$percent = \$li.find('.progress .progress-bar');                                    // 避免重复创建                                    if ( !\$percent.length ) {                                        \$percent = $('<div class=\"progress progress-striped active\">' +                                                '<div class=\"progress-bar\" role=\"progressbar\" style=\"width: 0%\">' +                                                '</div>' +                                                '</div>').appendTo( \$li ).find('.progress-bar');                                    }                                    \$li.find('.state').text('上传中');                                    \$percent.css( 'width', percentage * 100 + '%' );                                });                                uploader.on( 'uploadSuccess', function( file ,response) {                                    $( '#'+file.id ).find('.state').text('已上传');                                    //alert(response.data);                                    ";        if($limit==1){            $html .= "                           $('input[name={$input}]').val(response.data);                           $('#{$input}').attr('src',response.data);";        }else{            $html .= "$('#upload_success').append(\"<input name='{$input}'  data-rule='' type='hidden' value='\"+response.data+\"'/>\");                           $('#{$input}').attr('src',response.data);";        }        $html .= "                                });                                uploader.on( 'uploadError', function( file ) {                                    $( '#'+file.id ).find('.state').text('上传出错');                                });                                uploader.on( 'uploadComplete', function( file ){                                    $( '#'+file.id ).find('.progress').fadeOut();                                });                                uploader.on( 'all', function( type ) {                                    if ( type === 'startUpload' ) {                                        state = 'uploading';                                    } else if ( type === 'stopUpload' ) {                                        state = 'paused';                                    } else if ( type === 'uploadFinished' ) {                                        state = 'done';                                    }                                    if ( state === 'uploading' ) {                                        \$btn.text('暂停上传');                                    } else {                                        \$btn.text('开始上传');                                    }                                });                                \$btn.on( 'click', function() {                                    if ( state === 'uploading' ) {                                        uploader.stop();                                    } else {                                        uploader.upload();                                    }                                });                            });                        </script>";        return $html;    }}?>