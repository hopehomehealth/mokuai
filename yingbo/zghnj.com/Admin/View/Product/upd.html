<script type="text/javascript" src='{$Think.const.JS_URL}jquery-2.1.3.min.js'></script>
<script type="text/javascript" src='{$Think.const.JS_URL}uploadPreview.js'></script>
<script type="text/javascript" src='{$Think.const.PLUGIN_URL}ueditor/ueditor.config.js' ></script>
<script type="text/javascript" src='{$Think.const.PLUGIN_URL}ueditor/ueditor.all.min.js' ></script>
<script type="text/javascript" src='{$Think.const.PLUGIN_URL}ueditor/lang/zh-cn/zh-cn.js' ></script>
<div class="main-content">
    <div class="page-content">
        <div class="row">
            <div class="page-content box">
                <div class="box-title margin_bot_20">
                    <div class="span10">
                        <h3><i class="icon-magic"></i>编辑产品</h3>
                        <div class="pull-right"><button id="bsubmit" type="submit"  class="btn btn-sm btn-primary">保存产品</button></div>
                    </div>
                </div>
                <div class="breadcrumbs" style="border-left:1px solid #ccc">
                    <ul>
                        <li class="active"> <a href="#">基本信息 </a></li>

                        <li> <a href="#">产品特性 </a></li>

                        <li> <a href="#">产品描述 </a></li>

                        <li> <a href="#">产品相册 </a></li>

                        <!-- <li> <a href="#">旅游联票号 </a></li> -->
                    </ul>
                    <!-- .breadcrumb -->
                </div>
                <div>
                    <form action="__SELF__" method="post" enctype="multipart/form-data" class="form-horizontal" id="form">
                        <div class="formblock">
                            <div class="form-group">
                                <label class="control-label">产品名称 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="pdt_name" value="{$productinfo.pdt_name}" class="input-large">
                                </div>
                            </div>
                            <!-- <div class="form-group">
                                <label class="control-label">产品分类 : </label>
                                <div class="controls pull-left">
                                    <select class="input-medium" name="type_id">
                                        <option value='0'>请选择分类</option>
                                        <foreach name='typelist' item='v'>
                                            <option value='{$v.type_id}' <if condition="$v['type_id'] eq $productinfo['type_id']">selected</if> style="color:black">{$v.type_name}</option>
                                        </foreach>
                                    </select>
                                    <span class="help-inline red"> * </span>
                                </div>
                            </div> -->
                            <div class="form-group">
                                <label class="control-label">产品图片 : </label>
                                <div class="controls pull-left" style="position:relative;width:100px;height:100px;text-align:center;overflow:hidden;margin-top:5px">
                                    <input style="width:100%;height:100%;position:absolute;right:0;top:0;opacity:0;" type="file" class="input-large" id="logo" name="logo" >
                                    <div id="pic_div" style="background:url('{$Think.const.IMG_URL}selectpic.png') center 12px no-repeat;"><img id='pic_img' src='{$productinfo.logo}' width='100' height='100'></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">是否显示 : </label>
                                <div class="controls pull-left" style="padding-top:6px">
                                    <label>
                                        <input type="radio" class="ace" name="is_show" {$productinfo['is_show']?"checked":""} value="1">
                                        <span class="lbl">是</span>
                                    </label>
                                    <label>
                                        <input type="radio" class="ace" name="is_show" {$productinfo['is_show']?"":"checked"} value="0">
                                        <span class="lbl">否</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="formblock" style="display:none">
                            <div class="form-group">
                                <label class="control-label">产品特性1 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][0]}" class="input-large">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">产品特性2 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][1]}" class="input-large">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">产品特性3 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][2]}" class="input-large">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">产品特性4 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][3]}" class="input-large">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">产品特性5 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][4]}" class="input-large">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label">产品特性6 : </label>
                                <div class="controls pull-left" style="padding-top:3px">
                                    <input type="text" name="features[]" value="{$productinfo['features'][5]}" class="input-large">
                                </div>
                            </div>
                        </div>
                        <div class="formblock" style="display:none">
                            <div class="form-group">
                                <div class="controls pull-left" style="padding-top:10px">
                                    <textarea rows="5" cols="30" id='introduce' name='introduce' style='width:850px;height:350px;'>{$productinfo.introduce}</textarea>
                                </div>
                            </div>
                            <script type="text/javascript">
                                var ue = UE.getEditor('introduce',{toolbars: [[
                                            'fullscreen', 'source', '|', 'undo', 'redo', '|',
                                    'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'pasteplain', '|', 'forecolor', 'backcolor', 'selectall', 'cleardoc', '|',
                                    'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',
                                    'customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',
                                    'directionalityltr', 'directionalityrtl', 'indent', '|',
                                    'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
                                    'link', 'unlink', '|', 'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
                                    'simpleupload', 'insertimage','insertvideo', 'insertframe',  'attachment', 'map', 'pagebreak', '|',
                                    'horizontal', 'date', 'time', 'spechars', '|',
                                    'inserttable', 'deletetable', 'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols', 'charts', '|',
                                     'preview', 'searchreplace', 'drafts'
                                ]]});
                            </script>
                        </div>
                        <div class="formblock" style="display:none">
                            <foreach name='photos' key="k" item="info">
                                <if condition="$k eq 0">
                                    <div class="controls pull-left" style="position:relative;width:100px;height:100px;text-align:center;overflow:hidden;margin-right:5px">
                                        <input style="width:100%;height:100%;position:absolute;right:0;top:0;opacity:0;" type="file" class="input-large loopinput" id="picture0" name="url[]">
                                        <div id="pic_div0" style="background:url('{$Think.const.IMG_URL}selectpic.png') center 12px no-repeat;"><img width="100" height="100" id='pic_img0' src='{$info.url}'">
                                        </div>
                                        <input type="hidden" class="hiddeninput" name="oldpicture[]" data-id="{$info.id}" value="{$info.url}">
                                    </div>
                                    <script>
                                        $(function(){
                                            new uploadPreview({ UpBtn: "picture0", DivShow: "pic_div0", ImgShow: "pic_img0" });
                                        })
                                    </script>
                                <else/>
                                    <div class="controls pull-left" style="position:relative;width:100px;height:100px;text-align:center;overflow:hidden;margin-right:5px">
                                        <input style="width:100%;height:100%;position:absolute;right:0;top:0;opacity:0;" type="file" class="input-large loopinput" id="picture0{$k}" name="url[]" >
                                        <span style="position:absolute;right:0;top;0;color:red;text-align:center;width:20px;height:20px;line-height:20px;border:1px solid #ccc;cursor:pointer" onclick="removeinput(this)">X</span>
                                        <div id="pic_div0{$k}" style="background:url('{$Think.const.IMG_URL}selectpic.png') center 12px no-repeat;"><img width="100" height="100" id='pic_img0{$k}' src='{$info.url}'">
                                        </div>
                                        <input type="hidden" class="hiddeninput" name="oldpicture[]" data-id="{$info.id}" value="{$info.url}">
                                    </div>
                                    <script>
                                        $(function(){
                                            new uploadPreview({ UpBtn: "picture0{$k}", DivShow: "pic_div0{$k}", ImgShow: "pic_img0{$k}" });
                                        })
                                    </script>
                                </if>
                            </foreach>
                            <div class="controls pull-left" onclick="addinput(this)">
                                <div><img id='pic_img' src='{$Think.const.IMG_URL}plus.png'></div>
                            </div>
                        </div>
                        <input type="hidden" name="oldlogo" value="{$productinfo.logo}">
                    </form>
                </div>
            </div>
        </div>
        <!--/.box-->
    </div><!-- /.page-content -->
</div><!-- /.main-content -->
<script type="text/javascript">
    var counter = 0;
    function removeinput(_this){
        var id = $(_this).parent().find('.hiddeninput').data('id');
        var value = $(_this).parent().find('.hiddeninput').val();
        $("#form").append("<input type='hidden' name='delpicture["+id+"]' value='"+value+"'>");
        $(_this).parent().remove();
    }
    function addinput(_this){
        counter++;
        $(_this).before('<div class="controls pull-left" style="position:relative;width:100px;height:100px;text-align:center;overflow:hidden;margin-right:5px"><input style="width:100%;height:100%;position:absolute;right:0;top;0;opacity:0;" type="file" class="input-large" id="picture'+counter+'" name="url[]" ><span style="position:absolute;right:0;top;0;color:red;text-align:center;width:20px;height:20px;line-height:20px;border:1px solid #ccc;cursor:pointer" onclick="removeinput(this)">X</span><div id="pic_div'+counter+'" style="background:url(\'/Public/Admin/images/selectpic.png\') center 12px no-repeat;"><img width="100" height="100" id="pic_img'+counter+'" src=""></div></div>');
        new uploadPreview({ UpBtn: "picture"+counter, DivShow: "pic_div"+counter, ImgShow: "pic_img"+counter });
    }
    $(function(){
        new uploadPreview({ UpBtn: "logo", DivShow: "pic_div", ImgShow: "pic_img" });
        $(".loopinput").on('change',function(){
            var id = $(this).parent().find('.hiddeninput').data('id');
            var value = $(this).parent().find('.hiddeninput').val();
            $("#form").append("<input type='hidden' name='delpicture["+id+"]' value='"+value+"'>");
        })
        $(".breadcrumbs ul li").click(function(){
            $(this).addClass("active").siblings().removeClass('active');
            $(".formblock").eq($(this).index()).css("display","block").siblings().css("display","none");
        })
        $("#bsubmit").click(function(){
            $("#form").submit();
        })
    })
</script>
