<link href="{$Think.const.HCSS_URL}personal-style.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="{$Think.const.HJS_URL}jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="{$Think.const.HJS_URL}jquery.form.js"></script>
<style>
.orderinfo_main { width: 100%; background: #fff; }
.orderinfo_main1 { width: 100%; background: #fff; padding-bottom: 1rem; min-height: 7rem; }
.orderinfo_main1 dl dd { float: left; width: 26%; min-height: 7rem; }
.orderinfo_main1 dl dd img { width: 100%; margin-left: 0.5rem; }
.orderinfo_main1 dl dt { float: right; width: 70%; padding-top: 0.9rem; line-height: 2rem; font-size: 1.400rem; min-height: 7rem; margin-left: 1rem; }
.orderinfo_main1 dl dt h2 { font-size: 1.400rem; float: left; text-overflow: ellipsis; }
.orderinfo_main1 dl dt p { float: right; text-align: right; line-height: 1.5rem; margin-right: 0.5rem; }
.orderinfo_main1 dl dt p span { text-decoration: line-through; }
.orderinfo_main1 h3 { font-size: 1.400rem; line-height: 2rem; margin-left: 0.5rem; }
.orderinfo_main1 h3 span { float: right; margin-right: 0.5rem; }
.orderinfo_main2 { width: 100%; background: #fff; margin-top: 1rem; padding-bottom: 0.5rem; font-size:1.400rem; }
.orderinfo_main2 p { line-height: 2.5rem; margin-left: 0.5rem; }
.orderinfo_main2 ul { width: 100%; display: block; margin-top: 1rem; background: #fff; }
.orderinfo_main2 ul li { float: right; padding: 0.700rem 0 0.2rem; }
.orderinfo_main2 ul li input {font-size: 1.400rem; background: url("./Public/Home/images/white.png") repeat; color: #DF0245; padding:0.1rem 0.5rem; line-height: 2rem; border-radius:0.500rem; border:1px #DF0245 solid; margin-right:0.700rem; }

</style>
<section >
<div class="orderinfo_main pb7_5" style="background:#F0F0F0;">
            <notempty name="bookinfo">
            <div class="orderinfo_main1" style="background:#fff">
                   <dl>
                    <dd style="vertical-align:middle;margin-top:1rem"><a href="__MODULE__/Haoche/detail/goods_id/{$haocheinfo.goods_id}"><img src="{$Think.const.SITE_URL}{$haocheinfo.logo}" alt=""/></a></dd>
                    <dt style="float:right">
                        <h2 id="goodsname" goodsname="{$haocheinfo.goods_name}">型号：{$haocheinfo.goods_name}</h2>
                        <p>售价：<b style="color:#DD0045;">{$haocheinfo['price']/100/100}</b>万元</p>
                        <br/><br/><h2><if condition="$bookinfo.attr neq ''">颜色：{$bookinfo.attr}<else /></if></h2>

                    </dt>
                       <div style="clear: both"></div>
                       <h3>首付<span><b id="downpay" downpay="{$bookinfo['downpay']}" style="color: #DD0045;">{$bookinfo['downpay']/100/100}</b>万元</span></h3>
                       <h3 style="width:10%;float:left;padding-top:0.8rem;color:#DD0045;font-size:2rem;font-weight:bolder; display: inline-block">+<span style="color: #DD0045; float: left"></h3>
                       <h3 style="float: left;width: 80%;padding-top:1rem;display: inline-block">积分<span style="color: #DD0045; "><b>{$bookinfo['score']}</b></span></h3>
                </dl>
                <div style="clear: both;"></div>
            </div>
           <div class="orderinfo_main2" style="margin-top:1rem;padding-top:1rem">
               <p>姓名电话：&nbsp;&nbsp;&nbsp;{$bookinfo.customer}&nbsp;&nbsp;&nbsp;{$bookinfo.phone}</p>
               <p id="booksn" booksn="{$bookinfo.book_sn}">订车编号：&nbsp;&nbsp;&nbsp;{$bookinfo.book_sn}</p>
               <p id="inputtime" inputtime="{$bookinfo.inputtime}">订车日期：&nbsp;&nbsp;&nbsp;{$bookinfo.inputtime|date="Y-m-d H:i:s",###}</p>

               <if condition="$bookinfo.paytype neq '0'"><p>支付方式：&nbsp;&nbsp;&nbsp;<if condition="$bookinfo.paytype eq '1'">微信在线支付</if><if condition="$bookinfo.paytype eq '2'">线下支付</if></p></if>
               <p>支付状态：&nbsp;&nbsp;&nbsp;{$bookinfo['is_paydown']?"<span style='color:green'>已支付</span>":"<span style='color:red'>未支付</span>"}</p>
               <if condition="$bookinfo.paytime neq ''">
                  <p>支付日期：&nbsp;&nbsp;&nbsp;{$bookinfo.paytime|date="Y-m-d H:i:s",###}</p>
				  <if condition="$bookinfo.aplay_take eq '1'">
                    <p>提车申请：&nbsp;&nbsp;&nbsp;<span style='color:green'>已申请</span></p>
                  </if>
                  <if condition="$bookinfo.is_takecar eq '0'">
                    <p>是否提车：&nbsp;&nbsp;&nbsp;<span style='color:red'>未提车</span></p>
                  </if>
                  <if condition="$bookinfo.is_takecar eq '1'">
                    <p>是否提车：&nbsp;&nbsp;&nbsp;<span style='color:green'>已提车</span></p>
                    <p>提车日期：&nbsp;&nbsp;&nbsp;{$bookinfo.taketime|date="Y-m-d H:i:s",###}</p>
                  </if>
               </if>
               <if condition="$bookinfo.aplay_refunds eq '1'">
                  <p>退款申请：&nbsp;&nbsp;&nbsp;<span style='color:green'>已申请</span></p>
                  <p>申请日期：&nbsp;&nbsp;&nbsp;{$bookinfo.aplaytime|date="Y-m-d H:i:s",###}</p>
                  <if condition="$bookinfo.is_refunds eq '0'">
                    <p>是否退款：&nbsp;&nbsp;&nbsp;<span style='color:red'>未退款</span></p>
                  </if>
               </if>
               <if condition="$bookinfo.is_refunds eq '1'">
                  <p>是否退款：&nbsp;&nbsp;&nbsp;<span style='color:green'>已退款</span></p>
                  <p>退款日期：&nbsp;&nbsp;&nbsp;{$bookinfo.refundstime|date="Y-m-d H:i:s",###}</p>
               </if>
			   <p>微信在线支付：请点击立即付款</p>
			   <p>线下汇款银行账号：{$set['account']}</p>
			   <p style="color:#DD0045">线下支付成功后点击转账截图上传凭证</p>
           </div>
           <div id="opbookinfo" class="orderinfo_main2" style="background:#fff">
              <ul>
              <if condition="$bookinfo.is_refunds eq '1'">
                <li><a href="__MODULE__/Booking/cancel/book_id/{$bookinfo.book_id}"><input id="cancelbtn" style="border-color:#DD0045;" type="button" value="取消预定" /></a></li>
              </if>
              <if condition="$bookinfo.is_paydown eq '0'">
					<empty name="bookinfo.picscreen">
					<li id="zhuanzhang">
					<form action="__MODULE__/Booking/upscreen" method="post" enctype="multipart/form-data"  style=" padding-right:0.500rem;" id="upform">
						<input type="hidden" name="book_id" value="{$bookinfo['book_id']}">
						<input type="hidden" name="picscreen" value="{$bookinfo['picscreen']}">
                        <a class="ace-input btn btn-success btn-sm" style="height:2.4rem;width:7rem;line-height:2.4rem;margin:0;padding:0px;border-radius:0.5rem;display:inline-block;text-align:center;margin-left:0;" >
                    <input type="file" style="width:6rem;" id="selectpic" name="picscreen">转账截图</a>
					</form>
					</li>
					</empty>
					<notempty name="bookinfo.picscreen">
						<li><span style="display:inline-block;padding: 0.1rem 0.5rem;text-align:center;font-size:1.4rem;line-height: 2.2rem;height:2.2rem;border-radius: 0.500rem;margin-right: 0.700rem;width: 6rem;background-color: #999;color:white">等待确认</span></li>
					</notempty>
					<if condition="($bookinfo.is_paydown eq '0') AND ($bookinfo.picscreen eq '')">
					<li><a href="javascript:void(0)"><input bookid={$bookinfo.book_id} style="background-color: #DD0045;color:white" type="button" name="checkout" value="立即付款" /></a></li>
					</if>
              <elseif condition="($bookinfo.is_paydown eq '1') AND ($bookinfo.is_takecar eq '0') AND ($bookinfo.aplay_refunds eq '0')" />
				<if condition="($allowtake eq '1') AND ($bookinfo.aplay_take eq '0')">
					<li><input type="button" name="aplaytake" value="提车申请" style="background-color: #DD0045;color:white"/></li>
				</if>
				<if condition="($bookinfo.aplay_refunds eq '0') AND ($bookinfo.aplay_take eq '0')">
				<li><input type="button" name="aplayrefunds" value="申请退款" style="background-color: #DD0045;color:white"/></li>
				</if>
              </if>
              <if condition="($bookinfo.is_paydown eq '0') AND ($bookinfo.picscreen eq '')">
                <li><a href="__MODULE__/Booking/cancel/book_id/{$bookinfo.book_id}"><input id="cancelbtn" type="button" value="取消预定"  style="border-color:#DD0045;"/></a></li>
              </if>
            </ul>
            <div style="clear: both"></div>
           </div>
         </notempty>
         <empty name="bookinfo">
         <div class="exc_main" style="background:#F0F0F0">
          您当前没有预定
         </div>
        </empty>
        </div>

</section>
  <script type="text/javascript">
      $(function(){
        $("input[name='aplayrefunds']").click(function(){
            $("input[name='aplayrefunds']").attr('disabled',true);
            $.post("__MODULE__/Booking/aplayrefunds",{"inputtime":$("#inputtime").attr("inputtime")},function(data){
				if(data.error == '0'){
					$("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+data.content+"</div>");

					$("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);$("#bsubmit").attr('disabled',true);setTimeout(function(){$("#errormsg").remove();},2000);
					$("input[name='aplayrefunds']").attr('disabled',false);
					$("#opbookinfo").remove();
				}else if(data.error == '1'){
					$("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+data.content+"</div>");

					$("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);$("#bsubmit").attr('disabled',true);setTimeout(function(){$("#errormsg").remove();},2000);
					$("input[name='aplayrefunds']").attr('disabled',false);
				}
            })
        })
		$("#selectpic").change(function(){
			$("#upform").ajaxSubmit({
				type:'post',
				url:'__MODULE__/Booking/upscreen',
				success:function(data){
					if(data.error == 0){
						$("#zhuanzhang").html("<span style='display:inline-block;padding: 0.1rem 0.5rem;text-align:center;font-size:1.4rem;line-height: 2.2rem;height:2.2rem;border-radius: 0.500rem;margin-right: 0.700rem;width: 6rem;background-color: #999;color:white'>已上传</span>");
						$("input[name='checkout']").parent().parent().remove();
						$("#cancelbtn").parent().parent().remove();
					}
					if(data.error == 1){
						$("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+'库存不足'+"</div>");

						$("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);setTimeout(function(){$("#errormsg").remove();},2000);
					}

				},
				error:function(XmlHttpRequest,textStatus,errorThrown){
					console.log(XmlHttpRequest);
					console.log(textStatus);
					console.log(errorThrown);
				}
			});
		});
		//点击立即支付检查库存
		$("input[name='checkout']").click(function(){
			var bookid = $(this).attr('bookid');
			$.post("__MODULE__/Booking/checknumber",{'book_id':bookid},function(data){
				if(data.error == 0){
					location.href="__MODULE__/Wxpay/pay/type/downpay/id/"+bookid;
				}
				if(data.error == 1){
					$("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+'库存不足'+"</div>");

					$("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);setTimeout(function(){$("#errormsg").remove();},2000);
				}
			})
		})
		//提车申请
		$("input[name='aplaytake']").click(function(){
			$.post("__MODULE__/Booking/aplaytake",function(data){
				if(data == 'success'){
					 $("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+'提车申请成功'+"</div>");
					 $("#opbookinfo").remove();
					 $("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);setTimeout(function(){$("#errormsg").remove();},2000);
				}
				if(data == 'error'){
					$("section").append("<div id='errormsg' style='display:none;position:fixed;left:50%;top:50%;z-index:9999;width:12rem;height:3rem;margin-left:-6rem;margin-top:-1.5rem;text-align:center;line-height:3rem;color:white;font-weight:bold;font-size:1.5rem;opacity:0.7;background:#666'>"+'提车申请失败'+"</div>");

					 $("#errormsg").fadeIn(1000);$("#errormsg").fadeOut(1000);setTimeout(function(){$("#errormsg").remove();},2000);
				}
			})
		})
      })
    </script>
